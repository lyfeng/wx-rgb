<view class="container">
  <view class="header">
    <text class="title">颜色识别器</text>
  </view>
  
  <view class="main-content">
    <!-- 图片预览区域 -->
    <view class="image-preview">
      <image wx:if="{{tempImagePath}}" 
             src="{{tempImagePath}}" 
             mode="aspectFit" 
             bindtap="handleImageTap"
             bindload="onImageLoad"></image>
      
      <!-- 网格覆盖层 -->
      <view class="grid-overlay" wx:if="{{tempImagePath && gridCells.length > 0}}">
        <block wx:for="{{gridCells}}" wx:key="id">
          <view class="grid-cell" 
                style="left: {{item.x}}px; top: {{item.y}}px; width: {{item.width}}px; height: {{item.height}}px;"
                data-x="{{item.relativeX}}" 
                data-y="{{item.relativeY}}"
                catchtap="selectGridCell"></view>
        </block>
      </view>
      
      <!-- 选中的网格单元格 -->
      <view wx:if="{{tempImagePath && selectedGridCell}}" class="selected-grid-cell"
            style="left: {{selectedGridCell.x}}px; top: {{selectedGridCell.y}}px; width: {{selectedGridCell.width}}px; height: {{selectedGridCell.height}}px;"></view>
    </view>
    
    <!-- 网格提示 -->
    <view wx:if="{{tempImagePath}}" class="long-press-hint">
      <text>点击网格单元格可识别该区域颜色</text>
    </view>
    
    <!-- 操作按钮区域 -->
    <view class="action-buttons">
      <button class="btn" bindtap="chooseImage">选择图片</button>
      <button class="btn" bindtap="takePhoto">拍摄照片</button>
    </view>
    
    <!-- 在操作按钮区域下方添加算法选择选项卡 -->
    <view class="algorithm-tabs" wx:if="{{tempImagePath}}">
      <view class="tab {{currentAlgorithm === 'frequency' ? 'active' : ''}}" 
            bindtap="switchAlgorithm" data-algorithm="frequency">
        频率统计
      </view>
      <view class="tab {{currentAlgorithm === 'kmeans' ? 'active' : ''}}" 
            bindtap="switchAlgorithm" data-algorithm="kmeans">
        K-Means聚类
      </view>
      <view class="tab {{currentAlgorithm === 'median' ? 'active' : ''}}" 
            bindtap="switchAlgorithm" data-algorithm="median">
        中位切分
      </view>
    </view>
    
    <!-- 颜色结果展示区域 -->
    <view class="color-results" wx:if="{{colorResults.length > 0}}">
      <text class="section-title">识别结果</text>
      
      <!-- 普通识别颜色结果 -->
      <view class="colors-container">
        <view class="color-item" wx:for="{{colorResults}}" wx:key="index">
          <view class="color-block" style="background-color: {{item.hex}}"></view>
          <view class="color-info">
            <text class="color-hex" bindtap="copyText" data-text="{{item.hex}}">{{item.hex}}</text>
            <text class="color-rgb" bindtap="copyText" data-text="{{item.rgb}}">{{item.rgb}}</text>
            <text wx:if="{{item.name}}" class="color-name" bindtap="copyText" data-text="{{item.name}}">{{item.name}}</text>
            <text wx:if="{{item.percentage}}" class="color-percentage">占比: {{item.percentage}}%</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>

<canvas canvas-id="colorCanvas" id="colorCanvas" type="2d" style="width: 300px; height: 300px; position: absolute; left: -9999px; top: -9999px;"></canvas>